<!DOCTYPE html>
<html lang="en-us">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<meta name="theme-color" content="#494f5c">
	<meta name="msapplication-TileColor" content="#494f5c">

<meta itemprop="name" content="">
<meta itemprop="description" content="Mục lục
 Khái niệm Loadbalancer Định nghĩa Load balancing là một thành phần quan trọng của cơ sở hạ tầng thường được sử dụng để cải thiện hiệu suất và độ tin cậy của các trang web, các ứng dụng, cơ sở dữ liệu và các dịch vụ khác bằng cách phân phối khối lượng công việc trên nhiều máy chủ.
Một cơ sở hạ tầng web không có Load balancing có thể trông giống như sau:">



<meta itemprop="wordCount" content="2134">



<meta itemprop="keywords" content="" />
<meta property="og:title" content="" />
<meta property="og:description" content="Mục lục
 Khái niệm Loadbalancer Định nghĩa Load balancing là một thành phần quan trọng của cơ sở hạ tầng thường được sử dụng để cải thiện hiệu suất và độ tin cậy của các trang web, các ứng dụng, cơ sở dữ liệu và các dịch vụ khác bằng cách phân phối khối lượng công việc trên nhiều máy chủ.
Một cơ sở hạ tầng web không có Load balancing có thể trông giống như sau:" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://vzunnbii.github.io/posts/report_baitap/" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content=""/>
<meta name="twitter:description" content="Mục lục
 Khái niệm Loadbalancer Định nghĩa Load balancing là một thành phần quan trọng của cơ sở hạ tầng thường được sử dụng để cải thiện hiệu suất và độ tin cậy của các trang web, các ứng dụng, cơ sở dữ liệu và các dịch vụ khác bằng cách phân phối khối lượng công việc trên nhiều máy chủ.
Một cơ sở hạ tầng web không có Load balancing có thể trông giống như sau:"/>

	<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
	<link rel="manifest" href="/site.webmanifest">
	<link rel="mask-icon" href="/safari-pinned-tab.svg" color="">
	<link rel="shortcut icon" href="/favicon.ico">

	<title></title>
	<link rel="stylesheet" href="https://vzunnbii.github.io/css/style.min.31706917653d2b9e8410abd431f30ec4359a88a94fc87a63654779d87329edec.css" integrity="sha256-MXBpF2U9K56EEKvUMfMOxDWaiKlPyHpjZUd52HMp7ew=">
	
</head>

<body id="page">
	
	<header id="site-header" class="animated slideInUp faster">
		<div class="hdr-wrapper section-inner">
			<div class="hdr-left">
				<div class="site-branding">
					<a href="https://vzunnbii.github.io/">Alice Grace - I see through your eyes</a>
				</div>
				<nav class="site-nav hide-in-mobile">
					<a href="https://vzunnbii.github.io/posts/">Blog</a>
					<a href="https://vzunnbii.github.io/about/">About</a>
				</nav>
			</div>
			<div class="hdr-right hdr-icons">
				<span class="hdr-social hide-in-mobile"><a href="https://twitter.com/AliceGr97630817" target="_blank" rel="noopener" title="Twitter"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-twitter"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg></a><a href="https://www.instagram.com/zunnbii/" target="_blank" rel="noopener" title="Instagram"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-instagram"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path><line x1="17.5" y1="6.5" x2="17.5" y2="6.5"></line></svg></a><a href="https://github.com/vzunnbii" target="_blank" rel="noopener" title="Github"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></a><a href="https://fb.com/zunnbii" target="_blank" rel="noopener" title="Facebook"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-facebook"><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path></svg></a></span><button id="menu-btn" class="hdr-btn" title="Menu"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></button>
			</div>
		</div>
	</header>
	<div id="mobile-menu" class="animated fast">
		<ul>
			<li><a href="https://vzunnbii.github.io/posts/">Blog</a></li>
			<li><a href="https://vzunnbii.github.io/about/">About</a></li>
		</ul>
	</div>


	<main class="site-main section-inner animated fadeIn faster">
		<article class="thin">
			<header class="post-header">
				<div class="post-meta"><span>Jan 1, 0001</span></div>
				<h1></h1>
			</header>
			<div class="content">
				

<blockquote>
<p>Mục lục</p>
</blockquote>

<h1 id="khái-niệm-loadbalancer">Khái niệm Loadbalancer<a href="#khái-niệm-loadbalancer" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h1>

<h2 id="định-nghĩa">Định nghĩa<a href="#định-nghĩa" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>

<p>Load balancing là một thành phần quan trọng của cơ sở hạ tầng thường được sử dụng để cải thiện hiệu suất và độ tin cậy của các trang web, các ứng dụng, cơ sở dữ liệu và các dịch vụ khác bằng cách phân phối khối lượng công việc trên nhiều máy chủ.</p>

<p>Một cơ sở hạ tầng web không có Load balancing có thể trông giống như sau:</p>

<p align="center">
  <img src="https://viblo.asia/uploads/9ef3bb43-3d54-49fa-90be-d464751e5b47.png">
  <br/>
</p>

<p>Trong ví dụ này, người sử dụng kết nối trực tiếp đến máy chủ web, tại yourdomain.com. Nếu máy chủ web duy nhất này down, người sử dụng sẽ không thể truy cập vào trang web. Ngoài ra, nếu nhiều người dùng cố gắng truy cập vào máy chủ cùng một lúc thì nó không thể xử lý tải, họ có thể gặp thời gian tải chậm hoặc không thể kết nối.</p>

<p>Đây là điểm có thể khắc phục bằng một load balancer và ít nhất một máy chủ web bổ sung trên backend. Thông thường, tất cả các máy chủ phụ trợ sẽ cung cấp nội dung giống hệt nhau để người dùng nhận được nội dung phù hợp bất kể là máy chủ nào đáp ứng.</p>

<p align="center">
  <img src="https://viblo.asia/uploads/65fad7fe-c1b6-4798-8bdd-94232331f8f8.png">
  <br/>
</p>

<p>Trong ví dụ minh họa ở trên, người dùng truy cập vào load balancer và nó sẽ chuyển tiếp yêu cầu của người sử dụng đến một máy chủ phụ trợ, sau đó đáp ứng trực tiếp yêu cầu của người dùng. Trong kịch bản này, việc truy cập đến duy nhất 1 load balance cũng khiến server đáp ứng chậm. Điều này có thể được giảm nhẹ bằng cách giới thiệu một load balance thứ hai, nhưng trước khi chúng ta thảo luận về điều đó, hãy tìm hiểu cách thức load balance hoạt động.</p>

<h2 id="những-loại-giao-thức-load-balancers-có-thể-xử-lý">Những loại giao thức load balancers có thể xử lý:<a href="#những-loại-giao-thức-load-balancers-có-thể-xử-lý" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>

<p>Quản trị Load balancer tạo quy định chuyển tiếp đối với bốn loại giao thức chính:</p>

<ul>
<li>HTTP - Chuẩn HTTP balancing chỉ đạo yêu cầu dựa trên cơ chế HTTP chuẩn. Load Balancer đặt X-Forwarded-For, X-Forwarded-Proto, và tiêu đề X-Forwarded-Port để cung cấp cho các thông tin backends về các yêu cầu ban đầu.</li>
<li>HTTPS - HTTPS balancing với các chức năng tương tự như HTTP balancing, với sự bổ sung của mã hóa. Mã hóa được xử lý theo một trong hai cách: hoặc là với passthrough SSL duy trì mã hóa tất cả con đường đến backend hoặc chấm dứt SSL mà đặt gánh nặng giải mã vào load balancer nhưng gửi lưu lượng được mã hóa đến back end.</li>
<li>TCP - Đối với các ứng dụng không sử dụng HTTP hoặc HTTPS, lưu lượng TCP cũng có thể được cân bằng. Ví dụ, lượng truy cập vào một cụm cơ sở dữ liệu có thể được lan truyền trên tất cả các máy chủ.</li>
<li>UDP - Gần đây, một số load balancer đã thêm hỗ trợ cho cân bằng tải giao thức internet lõi như DNS và syslogd sử dụng UDP.</li>
</ul>

<p>Những quy tắc chuyển tiếp sẽ xác định các giao thức và cổng vào load balancer và bản đồ chúng đến các giao thức và cổng load balancer sẽ sử dụng để định tuyến lưu lượng trên backend.</p>

<h2 id="làm-thế-nào-để-load-balancer-chọn-máy-chủ-backend">Làm thế nào để load balancer chọn máy chủ backend?<a href="#làm-thế-nào-để-load-balancer-chọn-máy-chủ-backend" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>

<p>Load balancers chọn máy chủ để chuyển tiếp yêu cầu dựa trên sự kết hợp của hai yếu tố. Lần đầu tiên sẽ đảm bảo rằng bất kỳ máy chủ được lựa chọn có thể thực sự đáp ứng yêu cầu và sau đó sử dụng một quy tắc được cấu hình sẵn để lựa chọn trong số đó.</p>

<h3 id="health-checks">Health Checks<a href="#health-checks" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>

<p>Load balancer chỉ chuyển tiếp lưu lượng đến &ldquo;healthy&rdquo; backend server. Để theo dõi sức khỏe của một backend server, kiểm tra sức khỏe thường xuyên bằng cách cố gắng kết nối với backend server sử dụng giao thức và cổng được định nghĩa bởi các quy tắc chuyển tiếp để đảm bảo rằng các máy chủ đang lắng nghe. Nếu một máy chủ không kiểm tra sức khỏe, và do đó không thể phục vụ yêu cầu, nó sẽ tự động loại bỏ khỏi vùng chứa, và request sẽ không được chuyển tiếp đến nó cho đến khi nó đáp ứng việc kiểm tra sức khỏe một lần nữa.</p>

<h3 id="các-thuật-toán-load-balancer">Các thuật toán load balancer<a href="#các-thuật-toán-load-balancer" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>

<p>Các thuật toán load balancer được sử dụng xác định của máy chủ lành mạnh trên backend sẽ được lựa chọn. Một số các thuật toán thường được sử dụng là:</p>

<ul>
<li>Round Robin - Round Robin có nghĩa là các máy chủ sẽ được lựa chọn theo tuần tự. Bộ load balancer sẽ chọn máy chủ đầu tiên trong danh sách của mình đối với yêu cầu đầu tiên, sau đó di chuyển xuống trong danh sách theo thứ tự, bắt đầu lại ở đầu trang khi đi đến cuối cùng.</li>
<li>Least Connections - load balancer sẽ chọn máy chủ với các kết nối ít nhất.</li>
<li>Source - Với các thuật toán mã nguồn, load balancer sẽ chọn máy chủ để sử dụng dựa trên một hash của IP nguồn của yêu cầu, chẳng hạn như địa chỉ IP của người truy cập. Phương pháp này đảm bảo rằng một người dùng cụ thể sẽ luôn kết nối với cùng một máy chủ.</li>
</ul>

<p>Các thuật toán có người quản lý khác nhau tùy thuộc vào công nghệ load balancer sử dụng.</p>

<h2 id="làm-thế-nào-để-load-balancer-xử-lý-tra-ng-tha-i">Làm thế nào để load balancer xử lý trạng thái?<a href="#làm-thế-nào-để-load-balancer-xử-lý-tra-ng-tha-i" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>

<p>Một số ứng dụng yêu cầu người dùng tiếp tục kết nối đến cùng một backend server. Một thuật toán mã nguồn tạo ra một mối quan hệ dựa trên thông tin IP khách hàng. Một cách khác để đạt được điều này ở mức ứng dụng web là thông qua sticky sessions, nơi load balancer đặt một cookie và tất cả các requests từ sessions hướng đến một máy chủ vật lý.</p>

<h2 id="load-balancer-dự-phòng">Load balancer dự phòng<a href="#load-balancer-dự-phòng" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>

<p>Để loại bỏ việc load balancer như một điểm truy cập duy nhất, một load balancer thứ hai có thể được kết nối với cái đầu tiên để tạo thành một cụm. Mỗi load balancer là đều có khả năng phát hiện lỗi và phục hồi.</p>

<p align="center">
  <img src="https://viblo.asia/uploads/5f72fc77-5ba3-4dc5-9d73-8ff37f33fff9.png">
  <br/>
</p>

<p>Trong trường hợp load balancer chính bị lỗi, DNS phải đưa người dùng đến các bộ load balancer thứ hai. Bởi vì thay đổi DNS có thể mất một lượng thời gian đáng kể để được tải lên Internet và để làm cho chuyển đổi dự phòng này tự động, nhiều quản trị viên sẽ sử dụng hệ thống, cho phép linh hoạt địa chỉ IP Remapping, chẳng hạn như các floating IPs. Theo yêu cầu địa chỉ IP Remapping giúp loại bỏ các vấn đề tuyên truyền, bộ nhớ đệm vốn có trong những thay đổi DNS bằng cách cung cấp một địa chỉ IP tĩnh có thể được dễ dàng ánh xạ lại khi cần thiết. Tên miền có thể duy trì liên kết với các địa chỉ IP, trong khi các địa chỉ IP của chính nó được di chuyển giữa các máy chủ.</p>

<p>Đây là cách một cơ sở hạ tầng sử dụng Floating IPs có thể xem xét:</p>

<p align="center">
  <img src="https://viblo.asia/uploads/7f9b9acf-6ba0-4f4d-96c1-272cc7beb95c.gif">
  <br/>
</p>

<h1 id="nginx">NGINX<a href="#nginx" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h1>

<h2 id="nginx-là-gì">NGINX là gì?<a href="#nginx-là-gì" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>

<p align="center">
  <img src="https://quiksite.com/wp-content/uploads/2016/09/Nginx-Logo-02.png">
  <br/>
</p>

<p>NGINX dẫn đầu gói hiệu năng web nhờ cách phần mềm được thiết kế. Trong khi nhiều máy chủ web và máy chủ ứng dụng sử dụng kiến ​​trúc dựa trên luồng hoặc xử lý đơn giản, NGINX nổi bật với kiến ​​trúc hướng sự kiện phức tạp cho phép nó mở rộng tới hàng trăm ngàn kết nối đồng thời trên phần cứng hiện đại.</p>

<p>Bài viết: <a href="https://www.nginx.com/resources/library/infographic-inside-nginx/">Inside Nginx</a>.</p>

<p>Để hiểu rõ hơn về thiết kế này, bạn cần hiểu cách NGINX hoạt động. Có một quy trình công việc trên mỗi lõi để sử dụng hiệu quả tài nguyên phần cứng, khả năng xen kẽ nhiều kết nối trong một quy trình công việc duy nhất và khả năng chuyển từ kết nối này sang kết nối kia gần như ngay lập tức khi lưu lượng mạng tăng. Kết hợp tất cả lại với nhau, bạn tạo ra công cụ phân phối ứng dụng HTTP có thể mở rộng quy mô lớn là NGINX.</p>

<p align="center">
  <img src="https://www.nginx.com/wp-content/uploads/2015/04/nginx_architecture_thumbnail.png">
  <br/>
</p>

<h2 id="bối-cảnh-và-mô-hình-xử-lý-của-nginx">Bối cảnh và mô hình xử lý của NGINX<a href="#bối-cảnh-và-mô-hình-xử-lý-của-nginx" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>

<p align="center">
  <img src="https://www.nginx.com/wp-content/uploads/2015/06/infographic-Inside-NGINX_process-model.png">
  <br/>
</p>

<p>NGINX có một quy trình tổng thể (thực hiện các hoạt động đặc quyền như đọc cấu hình và liên kết với các cổng) và một số quy trình công việc và trợ giúp.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;</span><span class="c1"># service nginx restart</span>
<span class="o">*</span> <span class="n">Restarting</span> <span class="n">nginx</span>
<span class="c1"># ps -ef --forest | grep nginx</span>
<span class="n">root</span>     <span class="mi">32475</span>     <span class="mi">1</span>  <span class="mi">0</span> <span class="mi">13</span><span class="p">:</span><span class="mi">36</span> <span class="err">?</span>        <span class="mo">00</span><span class="p">:</span><span class="mo">00</span><span class="p">:</span><span class="mo">00</span> <span class="n">nginx</span><span class="p">:</span> <span class="n">master</span> <span class="n">process</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">nginx</span> 
                                                <span class="o">-</span><span class="n">c</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">nginx</span><span class="o">.</span><span class="n">conf</span>
<span class="n">nginx</span>    <span class="mi">32476</span> <span class="mi">32475</span>  <span class="mi">0</span> <span class="mi">13</span><span class="p">:</span><span class="mi">36</span> <span class="err">?</span>        <span class="mo">00</span><span class="p">:</span><span class="mo">00</span><span class="p">:</span><span class="mo">00</span>  <span class="n">_</span> <span class="n">nginx</span><span class="p">:</span> <span class="n">worker</span> <span class="n">process</span>
<span class="n">nginx</span>    <span class="mi">32477</span> <span class="mi">32475</span>  <span class="mi">0</span> <span class="mi">13</span><span class="p">:</span><span class="mi">36</span> <span class="err">?</span>        <span class="mo">00</span><span class="p">:</span><span class="mo">00</span><span class="p">:</span><span class="mo">00</span>  <span class="n">_</span> <span class="n">nginx</span><span class="p">:</span> <span class="n">worker</span> <span class="n">process</span>
<span class="n">nginx</span>    <span class="mi">32479</span> <span class="mi">32475</span>  <span class="mi">0</span> <span class="mi">13</span><span class="p">:</span><span class="mi">36</span> <span class="err">?</span>        <span class="mo">00</span><span class="p">:</span><span class="mo">00</span><span class="p">:</span><span class="mo">00</span>  <span class="n">_</span> <span class="n">nginx</span><span class="p">:</span> <span class="n">worker</span> <span class="n">process</span>
<span class="n">nginx</span>    <span class="mi">32480</span> <span class="mi">32475</span>  <span class="mi">0</span> <span class="mi">13</span><span class="p">:</span><span class="mi">36</span> <span class="err">?</span>        <span class="mo">00</span><span class="p">:</span><span class="mo">00</span><span class="p">:</span><span class="mo">00</span>  <span class="n">_</span> <span class="n">nginx</span><span class="p">:</span> <span class="n">worker</span> <span class="n">process</span>
<span class="n">nginx</span>    <span class="mi">32481</span> <span class="mi">32475</span>  <span class="mi">0</span> <span class="mi">13</span><span class="p">:</span><span class="mi">36</span> <span class="err">?</span>        <span class="mo">00</span><span class="p">:</span><span class="mo">00</span><span class="p">:</span><span class="mo">00</span>  <span class="n">_</span> <span class="n">nginx</span><span class="p">:</span> <span class="n">cache</span> <span class="n">manager</span> <span class="n">process</span>
<span class="n">nginx</span>    <span class="mi">32482</span> <span class="mi">32475</span>  <span class="mi">0</span> <span class="mi">13</span><span class="p">:</span><span class="mi">36</span> <span class="err">?</span>        <span class="mo">00</span><span class="p">:</span><span class="mo">00</span><span class="p">:</span><span class="mo">00</span>  <span class="n">_</span> <span class="n">nginx</span><span class="p">:</span> <span class="n">cache</span> <span class="n">loader</span> <span class="n">process</span></code></pre></div>
<p>Trên máy chủ bốn lõi này, quy trình chủ NGINX tạo ra bốn quy trình worker và một vài quy trình trợ giúp bộ đệm để quản lý bộ đệm nội dung trên đĩa.</p>

<h2 id="nginx-hoạt-động-như-thế-nào">NGINX hoạt động như thế nào?<a href="#nginx-hoạt-động-như-thế-nào" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>

<p>NGINX sử dụng mô hình quy trình dự đoán được điều chỉnh theo tài nguyên phần cứng có sẵn:</p>

<ul>
<li>Các quá trình master thực hiện các hoạt động đặc quyền như đọc cấu hình và gắn vào cổng, và sau đó tạo ra một số lượng nhỏ các tiến trình con (ba loại sau đây).</li>
<li>Các bộ nhớ cache nạp quá trình chạy lúc khởi động để nạp bộ nhớ cache đĩa dựa vào bộ nhớ, và sau đó thoát ra. Nó được lên kế hoạch một cách cẩn thận, do đó nhu cầu tài nguyên của nó thấp.</li>
<li>Các tiến trình quản lý bộ nhớ cache chạy theo định kỳ và giảm bớt dữ liệu đầu vào từ bộ nhớ đệm đĩa để giữ cho chúng trong các kích thước đã định sẵn.</li>
<li>Các tiến trình hoạt động làm tất cả các công việc. Chúng xử lý kết nối mạng, đọc &amp; ghi nội dung vào đĩa và liên lạc với các máy chủ ngược chiều.</li>
</ul>

<p>Cấu hình NGINX được khuyên dùng trong hầu hết các trường hợp - chạy một tiến trình worker trên mỗi lõi CPU - giúp sử dụng hiệu quả nhất các tài nguyên phần cứng. Bạn định cấu hình nó bằng cách đặt tham số auto trên lệnh worker_processes:</p>

<blockquote>
<p>worker_processes auto;</p>
</blockquote>

<p>Khi một server NGINX hoạt động, chỉ có tiến trình worker bận. Mỗi tiến trình worker xử lý nhiều kết nối theo cách không chặn, giảm thiểu số lượng tình huống cần chuyển đổi.</p>

<p>Mỗi tiến trình worker là tiến trình xử lý đơn và chạy độc lập, chọn ngẫu nhiên một kết nối và xử lý chúng. Những tiến trình đó có thể giao tiếp sử dụng bộ nhớ để chia sẻ dữ liệu cache, dữ liệu tồn tại phiên và các nguồn cần chia sẻ khác.</p>

<h2 id="bên-trong-một-tiến-trình-worker-của-nginx">Bên trong một tiến trình worker của NGINX<a href="#bên-trong-một-tiến-trình-worker-của-nginx" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>

<p align="center">
  <img src="https://www.nginx.com/wp-content/uploads/2015/06/infographic-Inside-NGINX_worker-process.png">
  <br/>
</p>

<p>Mỗi tiến trình NGINX worker khởi động cùng với cấu hình NGINX và được cung cấp bộ nghe bởi tiến trình master.</p>

<p>Tiến trình NGINX worker bắt đầu bằng việc đợi event từ bộ nghe (accept_mutex và bảo vệ cốt lõi trung tâm). Even được khởi chạy bởi kết nối mới đến. Những kết nối này được khai báo đến một state machine - HTTP state machine thường được sử dụng nhiều nhất, nhưng NGINX cũng cung cấp state machine cho dòng (TCP thô) lưu lượng và một số giao thức thư tín (SMTP, IMAP và POP3).</p>

<p align="center">
  <img src="https://www.nginx.com/wp-content/uploads/2015/06/infographic-Inside-NGINX_request-flow.png">
  <br/>
</p>

<p>State machine về cơ bản là một bộ hướng dẫn cho NGINX để xử lý một yêu cầu. Hầu hết các máy chủ web thực hiện các chức năng tương tự NGINX đều sử dụng state machine tương tự - sự khác biệt nằm ở cách triển khai.</p>

<h1 id="tại-sao-nginx-sử-dụng-kiến-trúc-single-thread">Tại sao NGINX sử dụng kiến trúc single-thread?<a href="#tại-sao-nginx-sử-dụng-kiến-trúc-single-thread" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h1>

<p>Đơn giản, vì nó nhanh hơn kiến trúc multi-thread. NGINX chia tỉ lệ để hỗ trợ hàng trăm nghìn kết nối trên mỗi tiến trình worker một cách tuyệt vời. Mỗi kết nối mới tạo một file mô tả khác và tiêu thụ một lượng nhỏ bộ nhớ bổ sung trong tiến trình worker. Chi phí bổ dung cho mỗi kết nối là rất nhỏ. Tiến trình NGINX có thể được ghim vào CPUs. Chuyển đổi tình trạng là không cần thiết và chỉ được thực hiện khi đang không có công việc nào.</p>

<h1 id="nguồn">Nguồn<a href="#nguồn" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h1>

<p>Tham khảo:</p>

<ul>
<li><a href="https://www.digitalocean.com/">Digital Ocean</a></li>
<li><a href="https://viblo.asia/p/dinh-nghia-ve-load-balancing-07LKXEJkZV4">Định nghĩa Load balancing</a></li>
<li><a href="https://www.nginx.com/resources/glossary/nginx/">Nginx</a></li>
<li><a href="https://www.hostinger.vn/huong-dan/nginx-la-gi-no-hoat-dong-nhu-the-nao/">Cơ bản về Nginx</a></li>
<li><a href="https://www.nginx.com/blog/inside-nginx-how-we-designed-for-performance-scale/">Inside NGINX</a></li>
<li><a href="http://www.aosabook.org/en/nginx.html">Article about NGINX architecture</a></li>
</ul>

			</div>
			<hr class="post-end">
			<footer class="post-info">
				<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>2134 Words</p>
				<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>0001-01-01 07:06 &#43;0706</p>
			</footer>
		</article>
		<div class="post-nav thin">
			<a class="next-post" href="https://vzunnbii.github.io/posts/dtls/">
				<span class="post-nav-label"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>&nbsp;Newer</span><br><span>Đi tìm lẽ sống</span>
			</a>
		</div>
		<div id="comments" class="thin">
</div>
	</main>

	<footer id="site-footer" class="section-inner thin animated fadeIn faster">
		<p>&copy; 2019 <a href="https://vzunnbii.github.io/">Ngoc Anh - Alice Grace</a> &#183; <a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">CC BY-NC 4.0</a></p>
		<p>
			Made with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> &#183; Theme <a href="https://github.com/Track3/hermit" target="_blank" rel="noopener">Hermit</a> &#183; <a href="https://vzunnbii.github.io/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a>
		</p>
	</footer>


	<script src="https://vzunnbii.github.io/js/main.min.784417f5847151f848c339cf0acb13a06cbb648b1483435a28ed4556c4ead69b.js" integrity="sha256-eEQX9YRxUfhIwznPCssToGy7ZIsUg0NaKO1FVsTq1ps="></script>

</body>

</html>
